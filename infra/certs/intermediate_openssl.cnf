[ ca ]
default_ca = intermediate_ca

[ intermediate_ca ]
dir               = infra/certs/intermediate
certs             = $dir/certs
new_certs_dir     = $dir/newcerts
database          = $dir/index.txt
serial            = $dir/serial
RANDFILE          = $dir/private/.rand
private_key       = $dir/private/intermediate.key.pem
certificate       = $dir/certs/intermediate.cert.pem

default_md        = sha256
name_opt          = ca_default
cert_opt          = ca_default
default_days      = 375
policy            = policy_loose
email_in_dn       = no
copy_extensions   = copy

[ policy_loose ]
countryName             = optional
stateOrProvinceName     = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

[ req ]
default_bits        = 2048
prompt = no
distinguished_name  = req_distinguished_name
string_mask         = utf8only
default_md          = sha256
x509_extensions     = v3_ca

[ req_distinguished_name ]
countryName                     = US
stateOrProvinceName             = Wisconsin
localityName                    = Portage
0.organizationName              = twiceb
organizationalUnitName          = Vault
commonName                      = vault.twiceb.internal
emailAddress                    = ca@twiceb.local

[ v3_ca ]
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
basicConstraints = critical, CA:true
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

[ server_cert ]
basicConstraints = CA:FALSE
nsCertType = server
nsComment = "Vault Server Certificate"
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer:always
keyUsage = critical, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth

[ usr_cert ]
basicConstraints = CA:FALSE
nsCertType = client, email
nsComment = "Client Certificate"
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid,issuer
keyUsage = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = clientAuth, emailProtection

# used by vault server cet signnign
[v3_intermediate_ca]
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
basicConstraints = critical,CA:true,pathlen:0
keyUsage = critical, digitalSignature, cRLSign, keyCertSign

# [ ca ]
# default_ca = intermediate_ca

# [ intermediate_ca ]
# dir               = infra/certs/intermediate
# certs             = $dir/certs
# new_certs_dir     = $dir/newcerts
# database          = $dir/index.txt
# serial            = $dir/serial
# RANDFILE          = $dir/private/.rand
# private_key       = $dir/private/intermediate.key.pem
# certificate       = $dir/certs/intermediate.cert.pem
# email_in_dn       = no
# rand_serial       = yes

# default_md        = sha256
# name_opt          = ca_default
# cert_opt          = ca_default
# default_days      = 3650
# policy            = policy_matching

# [ policy_matching ]
# countryName             = match
# stateOrProvinceName     = match
# organizationName        = match
# commonName              = supplied

# [ req ]
# default_bits        = 4096
# prompt              = no
# default_md          = sha256
# distinguished_name  = req_distinguished_name

# [ req_distinguished_name ]
# countryName              = US
# stateOrProvinceName      = Wisconsin
# organizationName         = twiceb
# commonName               = twiceb Intermediate CA

# [ v3_intermediate_ca ]
# subjectKeyIdentifier    = hash
# authorityKeyIdentifier  = keyid:always,issuer
# basicConstraints        = critical,CA:true,pathlen:0
# keyUsage                = critical,cRLSign,keyCertSign

# [ server_cert ]
# # Extensions for server certificates (`man x509v3_config`).
# basicConstraints = CA:FALSE
# nsCertType = server
# nsComment = "OpenSSL Generated Server Certificate"
# subjectKeyIdentifier = hash
# authorityKeyIdentifier = keyid,issuer
# keyUsage = critical, digitalSignature, keyEncipherment
# extendedKeyUsage = serverAuth
# subjectAltName = @alt_names

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = vault.twiceb.internal
DNS.2 = localhost
IP.1 = 127.0.0.1
